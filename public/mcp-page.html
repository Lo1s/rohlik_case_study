<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MCP - Natural Language API</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family:
          -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        line-height: 1.6;
        color: #333;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
      }

      .container {
        max-width: 1000px;
        margin: 0 auto;
        padding: 20px;
      }

      .header {
        background: white;
        border-radius: 15px;
        padding: 30px;
        margin-bottom: 20px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        text-align: center;
      }

      .header h1 {
        color: #667eea;
        font-size: 2.5rem;
        margin-bottom: 10px;
      }

      .header p {
        color: #666;
        font-size: 1.1rem;
      }

      .main-content {
        display: grid;
        grid-template-columns: 1fr 300px;
        gap: 20px;
      }

      .chat-container {
        background: white;
        border-radius: 15px;
        padding: 20px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        display: flex;
        flex-direction: column;
        height: 600px;
      }

      .chat-history {
        flex: 1;
        overflow-y: auto;
        padding: 20px;
        background: #f8f9fa;
        border-radius: 8px;
        margin-bottom: 20px;
        border: 1px solid #e9ecef;
      }

      .message {
        margin-bottom: 15px;
        padding: 12px 16px;
        border-radius: 12px;
        max-width: 80%;
        word-wrap: break-word;
      }

      .user-message {
        background: #667eea;
        color: white;
        margin-left: auto;
        text-align: right;
      }

      .system-message {
        background: #e9ecef;
        color: #333;
        border-left: 4px solid #667eea;
      }

      .success-message {
        background: #d4edda;
        color: #155724;
        border-left: 4px solid #28a745;
      }

      .error-message {
        background: #f8d7da;
        color: #721c24;
        border-left: 4px solid #dc3545;
      }

      .input-container {
        display: flex;
        gap: 10px;
        align-items: flex-end;
      }

      .command-input {
        flex: 1;
        padding: 15px;
        border: 2px solid #e9ecef;
        border-radius: 12px;
        font-size: 16px;
        resize: vertical;
        min-height: 60px;
        font-family: inherit;
      }

      .command-input:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      }

      .send-btn {
        background: #667eea;
        color: white;
        border: none;
        padding: 15px 20px;
        border-radius: 12px;
        cursor: pointer;
        font-size: 16px;
        font-weight: 500;
        transition: background-color 0.2s;
        min-width: 80px;
      }

      .send-btn:hover {
        background: #5a6fd8;
      }

      .send-btn:disabled {
        background: #ccc;
        cursor: not-allowed;
      }

      .sidebar {
        display: flex;
        flex-direction: column;
        gap: 20px;
      }

      .examples-card,
      .help-card {
        background: white;
        border-radius: 15px;
        padding: 20px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      }

      .examples-card h3,
      .help-card h3 {
        color: #667eea;
        margin-bottom: 15px;
      }

      .example {
        background: #f8f9fa;
        padding: 10px 12px;
        border-radius: 6px;
        margin-bottom: 8px;
        cursor: pointer;
        transition: background-color 0.2s;
        font-size: 14px;
        border-left: 3px solid #667eea;
      }

      .example:hover {
        background: #e9ecef;
      }

      .help-section {
        margin-bottom: 15px;
        font-size: 14px;
      }

      .help-section strong {
        color: #667eea;
      }

      .loading {
        display: none;
        text-align: center;
        color: #667eea;
        font-style: italic;
      }

      .timestamp {
        font-size: 12px;
        color: #999;
        margin-top: 5px;
      }

      .actions-list,
      .errors-list {
        margin-top: 10px;
        padding-left: 20px;
      }

      .actions-list li {
        color: #28a745;
        margin-bottom: 3px;
      }

      .errors-list li {
        color: #dc3545;
        margin-bottom: 3px;
      }

      @media (max-width: 768px) {
        .main-content {
          grid-template-columns: 1fr;
        }

        .header h1 {
          font-size: 2rem;
        }

        .chat-container {
          height: 500px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header class="header">
        <h1>ü§ñ MCP - Natural Language API</h1>
        <p>
          Use natural language to interact with your e-commerce system. Create
          orders, manage products, and more!
        </p>
      </header>

      <div class="main-content">
        <div class="chat-container">
          <div class="chat-history" id="chatHistory">
            <div class="message system-message">
              <strong>ü§ñ MCP System:</strong> Welcome! I can help you manage
              orders and products using natural language. Try commands like
              "create order for 5 bananas and 3 apples" or "list products".
              <div class="timestamp">System initialized</div>
            </div>
          </div>

          <div class="loading" id="loading">Processing your command...</div>

          <div class="input-container">
            <textarea
              id="commandInput"
              class="command-input"
              placeholder="Type your command here... (e.g., 'create order for 5 bananas and 3 apples')"
              rows="2"
            ></textarea>
            <button id="sendBtn" class="send-btn">Send</button>
          </div>
        </div>

        <div class="sidebar">
          <div class="examples-card">
            <h3>üìù Example Commands</h3>
            <div class="example" data-command="list products">
              List available products
            </div>
            <div
              class="example"
              data-command="create order for 5 bananas and 3 apples"
            >
              Create order for 5 bananas and 3 apples
            </div>
            <div
              class="example"
              data-command="buy 2 milk and 1 bread and pay for it"
            >
              Buy 2 milk and 1 bread and pay for it
            </div>
            <div class="example" data-command="pay for order 1">
              Pay for order 1
            </div>
            <div class="example" data-command="cancel order 1">
              Cancel order 1
            </div>
          </div>

          <div class="help-card">
            <h3>‚ÑπÔ∏è Help</h3>
            <div class="help-section">
              <strong>Supported Actions:</strong><br />
              ‚Ä¢ Create orders<br />
              ‚Ä¢ List products<br />
              ‚Ä¢ Pay for orders<br />
              ‚Ä¢ Cancel orders
            </div>
            <div class="help-section">
              <strong>Tips:</strong><br />
              ‚Ä¢ Use numbers and product names<br />
              ‚Ä¢ Include "and" between items<br />
              ‚Ä¢ Add "pay for it" to auto-pay<br />
              ‚Ä¢ Be specific with order IDs
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      class McpInterface {
        constructor() {
          this.chatHistory = document.getElementById("chatHistory");
          this.commandInput = document.getElementById("commandInput");
          this.sendBtn = document.getElementById("sendBtn");
          this.loading = document.getElementById("loading");
          this.sessionId = this.generateSessionId();

          this.setupEventListeners();
        }

        setupEventListeners() {
          this.sendBtn.addEventListener("click", () => this.sendCommand());
          this.commandInput.addEventListener("keypress", (e) => {
            if (e.key === "Enter" && !e.shiftKey) {
              e.preventDefault();
              this.sendCommand();
            }
          });

          // Example command clicks
          document.querySelectorAll(".example").forEach((example) => {
            example.addEventListener("click", () => {
              const command = example.getAttribute("data-command");
              this.commandInput.value = command;
              this.commandInput.focus();
            });
          });
        }

        generateSessionId() {
          return "session_" + Math.random().toString(36).substr(2, 9);
        }

        async sendCommand() {
          const command = this.commandInput.value.trim();
          if (!command) return;

          // Add user message to chat
          this.addMessage(command, "user");

          // Clear input and show loading
          this.commandInput.value = "";
          this.setLoading(true);

          try {
            const response = await fetch("/api/mcp/command", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({
                command: command,
                sessionId: this.sessionId,
              }),
            });

            const data = await response.json();
            this.handleResponse(data);
          } catch (error) {
            this.addMessage(`Error: ${error.message}`, "error", null, null, [
              "Failed to communicate with MCP service",
            ]);
          } finally {
            this.setLoading(false);
          }
        }

        handleResponse(data) {
          const messageType =
            data.status === "success"
              ? "success"
              : data.status === "error"
                ? "error"
                : "system";

          this.addMessage(
            data.message,
            messageType,
            data.actions,
            data.result,
            data.errors,
          );
        }

        addMessage(
          content,
          type = "system",
          actions = null,
          result = null,
          errors = null,
        ) {
          const messageDiv = document.createElement("div");
          messageDiv.className = `message ${type}-message`;

          let messageContent = "";

          if (type === "user") {
            messageContent = `<strong>üë§ You:</strong> ${content}`;
          } else {
            const icon =
              type === "success" ? "‚úÖ" : type === "error" ? "‚ùå" : "ü§ñ";
            messageContent = `<strong>${icon} MCP:</strong> ${content}`;
          }

          // Add actions if present
          if (actions && actions.length > 0) {
            messageContent += `<ul class="actions-list">`;
            actions.forEach((action) => {
              messageContent += `<li>${action}</li>`;
            });
            messageContent += `</ul>`;
          }

          // Add errors if present
          if (errors && errors.length > 0) {
            messageContent += `<ul class="errors-list">`;
            errors.forEach((error) => {
              messageContent += `<li>${error}</li>`;
            });
            messageContent += `</ul>`;
          }

          // Add result preview if present
          if (result) {
            const resultPreview = this.formatResult(result);
            if (resultPreview) {
              messageContent += `<div style="margin-top: 10px; padding: 10px; background: rgba(0,0,0,0.05); border-radius: 4px; font-size: 12px;"><strong>Result:</strong> ${resultPreview}</div>`;
            }
          }

          messageContent += `<div class="timestamp">${new Date().toLocaleTimeString()}</div>`;

          messageDiv.innerHTML = messageContent;
          this.chatHistory.appendChild(messageDiv);
          this.chatHistory.scrollTop = this.chatHistory.scrollHeight;
        }

        formatResult(result) {
          if (!result) return null;

          if (Array.isArray(result)) {
            return `${result.length} items`;
          } else if (result.id) {
            return `ID: ${result.id}`;
          } else if (typeof result === "object") {
            return Object.keys(result).slice(0, 3).join(", ");
          }

          return null;
        }

        setLoading(isLoading) {
          this.loading.style.display = isLoading ? "block" : "none";
          this.sendBtn.disabled = isLoading;
        }
      }

      // Initialize the MCP interface when page loads
      document.addEventListener("DOMContentLoaded", () => {
        new McpInterface();
      });
    </script>
  </body>
</html>
